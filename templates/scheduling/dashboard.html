{% extends "base.html" %}

{% block content %}
  <h2 class="fw-light mb-4">My Session Dashboard</h2>
  
  {% for session in sessions %}
    <div class="card shadow-sm border-0 rounded-3 mb-3">
        <div class="card-body p-4">
            <div class="row align-items-center">
                
                <div class="col-md-8">
                    <h4 class="mb-1">Skill: {{ session.skill.name }}</h4>
                    
                    {% if session.teacher == user %}
                        <p class="fs-5 mb-1">
                            <strong>Role:</strong> Teacher for <strong>{{ session.learner.username }}</strong>
                        </p>
                    {% else %}
                        <p class="fs-5 mb-1">
                            <strong>Role:</strong> Learner with <strong>{{ session.teacher.username }}</strong>
                        </p>
                    {% endif %}
                    
                    <p class="text-muted mb-2"><i data-feather="calendar" class="feather"></i> {{ session.scheduled_time }}</p>
                    
                    {% if session.meeting_link %}
                        <p class="mb-0"><i data-feather="link" class="feather"></i> <strong>Link:</strong> <a href="{{ session.meeting_link }}" target="_blank">Join Session</a></p>
                    {% endif %}
                </div>

                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <div class="mb-2">
                        {% if session.status == 'pending' %}
                            <span class="badge bg-warning text-dark rounded-pill fs-6">Pending</span>
                        {% elif session.status == 'confirmed' %}
                            <span class="badge bg-success rounded-pill fs-6">Confirmed</span>
                        {% elif session.status == 'completed' %}
                            <span class="badge bg-info rounded-pill fs-6">Completed</span>
                        {% elif session.status == 'cancelled' %}
                            <span class="badge bg-danger rounded-pill fs-6">Cancelled</span>
                        {% endif %}
                    </div>

                    <div class="d-grid gap-2">
                        {% if session.status == 'pending' and session.teacher == user %}
                            <a href="{% url 'update_session_status' session_id=session.id new_status='confirm' %}" class="btn btn-success btn-sm"><i data-feather="check-circle" class="feather"></i> Confirm</a>
                            <a href="{% url 'update_session_status' session_id=session.id new_status='cancel' %}" class="btn btn-danger btn-sm"><i data-feather="x-circle" class="feather"></i> Cancel</a>
                        {% endif %}

                        {% if session.status == 'confirmed' and session.teacher == user %}
                            <a href="{% url 'update_session_link' session_id=session.id %}" class="btn btn-info btn-sm"><i data-feather="link" class="feather"></i> Add/Edit Link</a>
                            <a href="{% url 'update_session_status' session_id=session.id new_status='completed' %}" class="btn btn-warning btn-sm"><i data-feather="check-square" class="feather"></i> Mark as Completed</a>
                        {% endif %}
                        
                        {% if session.status == 'completed' and session.learner == user and not session.feedback %}
                            <a href="{% url 'add_feedback' session_id=session.id %}" class="btn btn-primary btn-sm"><i data-feather="star" class="feather" fill="currentColor"></i> Leave Feedback</a>
                        {% endif %}
                        
                        {% if session.feedback and session.learner == user %}
                             <p class="text-success small mb-0"><i data-feather="check-square" class="feather"></i> Feedback submitted.</p>
                        {% endif %}
                    </div>
                </div>

            </div>
        </div>
    </div>
  {% empty %}
    <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body p-5 text-center">
            <h4 class="fw-light">You have no scheduled sessions.</h4>
            <p class="text-muted">Find a match and request a session to get started!</p>
            <a href="{% url 'matches' %}" class="btn btn-primary mt-2">Find Matches</a>
        </div>
    </div>
  {% endfor %}
{% endblock %}