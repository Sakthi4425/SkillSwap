{% load static %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SkillSwap</title>
    {# Bootstrap CSS #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    {# Your Custom CSS for dark mode #}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        body {
            background-color: #f8f9fa; /* Default light */
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .feather {
            width: 1em;
            height: 1em;
            vertical-align: -0.125em;
            stroke-width: 2.5;
        }
        /* Add these styles to hide/show icons based on dark mode */
        .dark-mode .dark-mode-icon { display: inline-block; }
        .dark-mode .light-mode-icon { display: none; }
        .light-mode-icon { display: inline-block; }
        .dark-mode-icon { display: none; } /* Initially hidden */
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
      <div class="container">
        
        {% if user.is_authenticated %}
            <a class="navbar-brand" href="{% url 'session_dashboard' %}">
                <img src="{{ MEDIA_URL }}logo.png" alt="SkillSwap Logo" style="height: 50px;">
            </a>
        {% else %}
            <a class="navbar-brand" href="{% url 'home' %}">
                <img src="{{ MEDIA_URL }}logo.png" alt="SkillSwap Logo" style="height: 50px;">
            </a>
        {% endif %}
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto align-items-center"> {# <-- Use align-items-center for vertical alignment #}
            {% if user.is_authenticated %}
              <li class="nav-item"><a class="nav-link" href="{% url 'matches' %}"><i data-feather="users" class="feather"></i> Find Matches</a></li>
              <li class="nav-item"><a class="nav-link" href="{% url 'session_dashboard' %}"><i data-feather="calendar" class="feather"></i> Dashboard</a></li>
              <li class="nav-item"><a class="nav-link" href="{% url 'profile' %}"><i data-feather="user" class="feather"></i> Profile</a></li>
              <li class="nav-item">
                <form method="POST" action="{% url 'logout' %}" class="d-flex"> {# <-- Use d-flex if needed #}
                  {% csrf_token %}
                  <button class="nav-link btn btn-link" type="submit"><i data-feather="log-out" class="feather"></i> Logout</button>
                </form>
              </li>
            {% else %}
              <li class="nav-item"><a class="nav-link" href="{% url 'login' %}"><i data-feather="log-in" class="feather"></i> Login</a></li>
              <li class="nav-item"><a class="nav-link btn btn-primary text-white ms-2" href="{% url 'signup' %}">Sign Up</a></li> {# <-- Added ms-2 for spacing #}
            {% endif %}

            {# --- ADD THE DARK MODE TOGGLE BUTTON HERE --- #}
            <li class="nav-item ms-lg-2"> {# <-- Add margin for spacing #}
                <button class="btn btn-outline-secondary btn-sm" id="darkModeToggle" title="Toggle theme">
                    <i data-feather="moon" class="feather dark-mode-icon"></i>
                    <i data-feather="sun" class="feather light-mode-icon"></i>
                    <span class="d-lg-none ms-1">Toggle Theme</span> {# <-- Optional text for mobile #}
                </button>
            </li>
            {# --- END OF DARK MODE BUTTON --- #}
          </ul>
        </div>
      </div>
    </nav>

    <main class="container mt-4 py-4">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
      
      {% block content %}{% endblock %}
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <script>
      feather.replace(); // Initialize feather icons FIRST

      // --- ADD THE DARK MODE JAVASCRIPT LOGIC HERE ---
      const darkModeToggle = document.getElementById('darkModeToggle');
      const body = document.body;
      const moonIcon = document.querySelector('.dark-mode-icon');
      const sunIcon = document.querySelector('.light-mode-icon');

      // Function to set the theme based on preference
      function setTheme(isDarkMode) {
          if (isDarkMode) {
              body.classList.add('dark-mode');
              // Ensure feather.replace() is called again if icons are added/removed dynamically
              // For simple hiding/showing, CSS is usually sufficient
          } else {
              body.classList.remove('dark-mode');
          }
          // Update icon visibility using CSS (added in <style> block above)
          feather.replace(); // Re-run feather to draw the correct icon if visibility changed
      }

      // 1. Check for saved preference on page load
      const savedTheme = localStorage.getItem('theme');
      let currentIsDarkMode = false; // Keep track of the current state
      if (savedTheme === 'dark') {
          currentIsDarkMode = true;
      } else if (savedTheme === 'light') {
          currentIsDarkMode = false;
      } else {
          // Optional: Check system preference if no localStorage value
          currentIsDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      }
      setTheme(currentIsDarkMode); // Apply theme on load


      // 2. Add event listener for button click
      darkModeToggle.addEventListener('click', () => {
          currentIsDarkMode = !currentIsDarkMode; // Toggle the state
          setTheme(currentIsDarkMode);
          localStorage.setItem('theme', currentIsDarkMode ? 'dark' : 'light');
      });

      // Optional: Listen for system preference changes
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
        if (!localStorage.getItem('theme')) { // Only apply if user hasn't manually set a theme
            currentIsDarkMode = event.matches;
            setTheme(currentIsDarkMode);
        }
      });
      // --- END OF DARK MODE JAVASCRIPT ---

    </script>
     {# {% block extra_js %}{% endblock %} #} {# You might have an extra_js block, keep it if needed #}
</body>
</html>